{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Nikesh/Desktop/GuessWhere/guesswhere/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/Nikesh/Desktop/GuessWhere/guesswhere/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/Nikesh/Desktop/GuessWhere/guesswhere/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Nikesh/Desktop/GuessWhere/guesswhere/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useContext,useEffect,useState}from\"react\";import AddSubChallengeModal from\"./AddSubChallengeModal\";import firebase from\"../firebase\";import{AuthContext}from\"../AuthProvider\";import{Redirect}from\"react-router-dom\";import{Button,Snackbar,TextField}from\"@material-ui/core\";import SubChallengeBox from\"./SubChallengeBox\";import{v4 as uuidv4}from\"uuid\";import MuiAlert from\"@material-ui/lab/Alert\";import ParticlesBg from\"particles-bg\";var db=firebase.firestore();function CreateChallenge(props){var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),open=_useState2[0],setOpen=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),subchallenges=_useState4[0],setSubchallenges=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),submitDisabled=_useState6[0],setSubmitDisabled=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),uploading=_useState8[0],setUploading=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),wordValue=_useState10[0],setWordValue=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),snackOpen=_useState12[0],setSnackOpen=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),errorSnackOpen=_useState14[0],setErrorSnackOpen=_useState14[1];var handleSnackBarClose=function handleSnackBarClose(event,reason){if(reason===\"clickaway\"){return;}setSnackOpen(false);setErrorSnackOpen(false);};var handleOpen=function handleOpen(){setOpen(true);};var handleClose=function handleClose(){setOpen(false);};var getFileUrls=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(subchallenge){var fileUrls;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:fileUrls=[];_context2.next=3;return Promise.all(subchallenge.files.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){var storageRef,fileRef,fileUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:storageRef=firebase.storage().ref();fileRef=storageRef.child(uuidv4());_context.next=4;return fileRef.put(file);case 4:_context.next=6;return fileRef.getDownloadURL();case 6:fileUrl=_context.sent;fileUrls=[].concat(_toConsumableArray(fileUrls),[fileUrl]);case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}()));case 3:return _context2.abrupt(\"return\",fileUrls);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function getFileUrls(_x){return _ref.apply(this,arguments);};}();var addSubChallenges=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var subRefs;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:subRefs=[];_context4.next=3;return Promise.all(subchallenges.map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(subchallenge){var fileUrls;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getFileUrls(subchallenge);case 2:fileUrls=_context3.sent;_context3.next=5;return db.collection(\"Sub-challenges\").add({images:fileUrls,location:new firebase.firestore.GeoPoint(subchallenge.marker.lat,subchallenge.marker.lng)}).then(function(docRef){subRefs=[].concat(_toConsumableArray(subRefs),[docRef]);}).catch(function(error){setErrorSnackOpen(true);});case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref4.apply(this,arguments);};}()));case 3:return _context4.abrupt(\"return\",subRefs);case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function addSubChallenges(){return _ref3.apply(this,arguments);};}();var handleChallengeSubmit=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var subRefs;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setUploading(true);_context5.next=3;return addSubChallenges();case 3:subRefs=_context5.sent;_context5.next=6;return db.collection(\"Challenges\").add({uid:currentUser.uid,subchallenges:subRefs,name:wordValue}).catch(function(error){console.error(\"Error adding document: \",error);});case 6:setSnackOpen(true);setUploading(false);setSubchallenges([]);setWordValue(\"\");case 10:case\"end\":return _context5.stop();}}},_callee5);}));return function handleChallengeSubmit(){return _ref5.apply(this,arguments);};}();var handleSubChallengeSubmit=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(files,marker){var subchallenge;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:subchallenge={files:files,marker:marker};setSubchallenges(function(current){return[].concat(_toConsumableArray(current),[subchallenge]);});case 2:case\"end\":return _context6.stop();}}},_callee6);}));return function handleSubChallengeSubmit(_x4,_x5){return _ref6.apply(this,arguments);};}();var handleTextOnChange=function handleTextOnChange(e){setWordValue(e.target.value);};var handleRemoveSubChallenge=function handleRemoveSubChallenge(index){var tempsubarray=_toConsumableArray(subchallenges);tempsubarray.splice(index,1);setSubchallenges(tempsubarray);};useEffect(function(){if(subchallenges.length!==0&&wordValue!==\"\"){setSubmitDisabled(false);}else{if(!uploading){setSubmitDisabled(true);}}},[subchallenges,wordValue]);//console.log(subchallenges);\nif(!currentUser){return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:\"50px\",textAlign:\"center\",color:\"black\"},children:\"Create Challenge!\"}),/*#__PURE__*/_jsx(ParticlesBg,{type:\"circle\",bg:true})]}),/*#__PURE__*/_jsxs(\"div\",{style:{align:\"center\",width:\"300px\",border:\"5px dotted black\",padding:\"20px\",marginLeft:\"auto\",marginRight:\"auto\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:\"20px\",textAlign:\"center\",color:\"black\"},children:/*#__PURE__*/_jsx(TextField,{id:\"standard-basic\",label:\"Challenge Name\",value:wordValue,onChange:handleTextOnChange})}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:\"20px\",textAlign:\"center\",color:\"black\"},children:[/*#__PURE__*/_jsx(Button,{style:{fontSize:\"12px\",textAlign:\"center\",color:\"black\"},size:\"small\",onClick:handleOpen,children:\"Add a Sub Challenge\"}),/*#__PURE__*/_jsx(AddSubChallengeModal,{open:open,handleClose:handleClose,onSubmit:handleSubChallengeSubmit}),subchallenges.map(function(subchallenge,i){return/*#__PURE__*/_jsx(SubChallengeBox,{index:i,numImages:subchallenge.files.length,handleRemove:handleRemoveSubChallenge},i);})]}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(Button,{style:{fontSize:\"15px\",color:\"black\"},size:\"medium\",color:\"primary\",variant:\"outlined\",onClick:handleChallengeSubmit,disabled:submitDisabled,children:\"Submit\"})})]}),/*#__PURE__*/_jsx(Snackbar,{open:snackOpen,autoHideDuration:6000,onClose:handleSnackBarClose,children:/*#__PURE__*/_jsx(MuiAlert,{elevation:6,variant:\"filled\",onClose:handleSnackBarClose,severity:\"success\",children:\"Challenge successfully uploaded!\"})}),/*#__PURE__*/_jsx(Snackbar,{open:errorSnackOpen,autoHideDuration:6000,onClose:handleSnackBarClose,children:/*#__PURE__*/_jsx(MuiAlert,{elevation:6,variant:\"filled\",onClose:handleSnackBarClose,severity:\"error\",children:\"Error Occured When Uploading Challenge!\"})})]});}export default CreateChallenge;","map":{"version":3,"sources":["C:/Users/Nikesh/Desktop/GuessWhere/guesswhere/src/Components/CreateChallenge.js"],"names":["React","useContext","useEffect","useState","AddSubChallengeModal","firebase","AuthContext","Redirect","Button","Snackbar","TextField","SubChallengeBox","v4","uuidv4","MuiAlert","ParticlesBg","db","firestore","CreateChallenge","props","currentUser","open","setOpen","subchallenges","setSubchallenges","submitDisabled","setSubmitDisabled","uploading","setUploading","wordValue","setWordValue","snackOpen","setSnackOpen","errorSnackOpen","setErrorSnackOpen","handleSnackBarClose","event","reason","handleOpen","handleClose","getFileUrls","subchallenge","fileUrls","Promise","all","files","map","file","storageRef","storage","ref","fileRef","child","put","getDownloadURL","fileUrl","addSubChallenges","subRefs","collection","add","images","location","GeoPoint","marker","lat","lng","then","docRef","catch","error","handleChallengeSubmit","uid","name","console","handleSubChallengeSubmit","current","handleTextOnChange","e","target","value","handleRemoveSubChallenge","index","tempsubarray","splice","length","fontSize","textAlign","color","align","width","border","padding","marginLeft","marginRight","i"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\r\nimport AddSubChallengeModal from \"./AddSubChallengeModal\";\r\nimport firebase from \"../firebase\";\r\nimport { AuthContext } from \"../AuthProvider\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { Button, Snackbar, TextField } from \"@material-ui/core\";\r\nimport SubChallengeBox from \"./SubChallengeBox\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport MuiAlert from \"@material-ui/lab/Alert\";\r\nimport ParticlesBg  from \"particles-bg\";\r\n\r\nconst db = firebase.firestore();\r\n\r\nfunction CreateChallenge(props) {\r\n  const { currentUser } = useContext(AuthContext);\r\n  const [open, setOpen] = useState(false);\r\n  const [subchallenges, setSubchallenges] = useState([]);\r\n  const [submitDisabled, setSubmitDisabled] = useState(true);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [wordValue, setWordValue] = useState(\"\");\r\n  const [snackOpen, setSnackOpen] = useState(false);\r\n  const [errorSnackOpen, setErrorSnackOpen] = useState(false);\r\n\r\n  const handleSnackBarClose = (event, reason) => {\r\n    if (reason === \"clickaway\") {\r\n      return;\r\n    }\r\n    setSnackOpen(false);\r\n    setErrorSnackOpen(false);\r\n  };\r\n\r\n  const handleOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  const getFileUrls = async (subchallenge) => {\r\n    var fileUrls = [];\r\n    await Promise.all(\r\n      subchallenge.files.map(async (file) => {\r\n        const storageRef = firebase.storage().ref();\r\n        const fileRef = storageRef.child(uuidv4());\r\n        await fileRef.put(file);\r\n        const fileUrl = await fileRef.getDownloadURL();\r\n        fileUrls = [...fileUrls, fileUrl];\r\n      })\r\n    );\r\n    return fileUrls;\r\n  };\r\n\r\n  const addSubChallenges = async () => {\r\n    var subRefs = [];\r\n    await Promise.all(\r\n      subchallenges.map(async (subchallenge) => {\r\n        const fileUrls = await getFileUrls(subchallenge);\r\n        await db\r\n          .collection(\"Sub-challenges\")\r\n          .add({\r\n            images: fileUrls,\r\n            location: new firebase.firestore.GeoPoint(\r\n              subchallenge.marker.lat,\r\n              subchallenge.marker.lng\r\n            ),\r\n          })\r\n          .then(function (docRef) {\r\n            subRefs = [...subRefs, docRef];\r\n          })\r\n          .catch(function (error) {\r\n            setErrorSnackOpen(true);\r\n          });\r\n      })\r\n    );\r\n    return subRefs;\r\n  };\r\n\r\n  const handleChallengeSubmit = async () => {\r\n    setUploading(true);\r\n    const subRefs = await addSubChallenges();\r\n    await db\r\n      .collection(\"Challenges\")\r\n      .add({\r\n        uid: currentUser.uid,\r\n        subchallenges: subRefs,\r\n        name: wordValue,\r\n      })\r\n      .catch(function (error) {\r\n        console.error(\"Error adding document: \", error);\r\n      });\r\n    setSnackOpen(true);\r\n    setUploading(false);\r\n    setSubchallenges([]);\r\n    setWordValue(\"\");\r\n  };\r\n\r\n  const handleSubChallengeSubmit = async (files, marker) => {\r\n    const subchallenge = { files, marker };\r\n    setSubchallenges((current) => [...current, subchallenge]);\r\n  };\r\n\r\n  const handleTextOnChange = (e) => {\r\n    setWordValue(e.target.value);\r\n  };\r\n\r\n  const handleRemoveSubChallenge = (index) => {\r\n    var tempsubarray = [...subchallenges];\r\n    tempsubarray.splice(index, 1);\r\n    setSubchallenges(tempsubarray);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (subchallenges.length !== 0 && wordValue !== \"\") {\r\n      setSubmitDisabled(false);\r\n    } else {\r\n      if (!uploading) {\r\n        setSubmitDisabled(true);\r\n      }\r\n    }\r\n  }, [subchallenges, wordValue]);\r\n\r\n  //console.log(subchallenges);\r\n  if (!currentUser) {\r\n    return <Redirect to=\"/\" />;\r\n  }\r\n  return (\r\n    <div>\r\n      <div>\r\n      <h1 style={{fontSize: \"50px\", textAlign: \"center\", color:\"black\"}} >Create Challenge!</h1>\r\n        <ParticlesBg type=\"circle\" bg={true} />\r\n      </div>\r\n      <div\r\n      style={{\r\n        align: \"center\",\r\n        width: \"300px\",\r\n        border: \"5px dotted black\",\r\n        padding: \"20px\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\"}} >\r\n      <div style={{fontSize: \"20px\", textAlign: \"center\", color: \"black\"}}>\r\n        <TextField\r\n          id=\"standard-basic\"\r\n          label=\"Challenge Name\"\r\n          value={wordValue}\r\n          onChange={handleTextOnChange}\r\n        />\r\n      </div>\r\n      <div style={{fontSize: \"20px\", textAlign: \"center\", color: \"black\"}}>\r\n        <Button style={{fontSize: \"12px\", textAlign: \"center\", color: \"black\"}} size=\"small\" onClick={handleOpen}>\r\n          Add a Sub Challenge\r\n        </Button>\r\n        <AddSubChallengeModal\r\n          open={open}\r\n          handleClose={handleClose}\r\n          onSubmit={handleSubChallengeSubmit}\r\n        />\r\n        {subchallenges.map((subchallenge, i) => (\r\n          <SubChallengeBox\r\n            key={i}\r\n            index={i}\r\n            numImages={subchallenge.files.length}\r\n            handleRemove={handleRemoveSubChallenge}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div style={{textAlign: \"center\"}}>\r\n      <Button \r\n          style={{fontSize: \"15px\", color: \"black\"}}\r\n          size=\"medium\"\r\n          color=\"primary\"\r\n          variant=\"outlined\"\r\n          onClick={handleChallengeSubmit}\r\n          disabled={submitDisabled}\r\n        >\r\n          Submit\r\n        </Button>\r\n      </div>\r\n      </div>\r\n      <Snackbar\r\n        open={snackOpen}\r\n        autoHideDuration={6000}\r\n        onClose={handleSnackBarClose}\r\n      >\r\n        <MuiAlert\r\n          elevation={6}\r\n          variant=\"filled\"\r\n          onClose={handleSnackBarClose}\r\n          severity=\"success\"\r\n        >\r\n          Challenge successfully uploaded!\r\n        </MuiAlert>\r\n      </Snackbar>\r\n      <Snackbar\r\n        open={errorSnackOpen}\r\n        autoHideDuration={6000}\r\n        onClose={handleSnackBarClose}\r\n      >\r\n        <MuiAlert\r\n          elevation={6}\r\n          variant=\"filled\"\r\n          onClose={handleSnackBarClose}\r\n          severity=\"error\"\r\n        >\r\n          Error Occured When Uploading Challenge!\r\n        </MuiAlert>\r\n      </Snackbar>\r\n    </div>\r\n  );\r\n}\r\nexport default CreateChallenge;\r\n"]},"metadata":{},"sourceType":"module"}